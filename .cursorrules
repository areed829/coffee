# Cursor Rules for Coffee Repository

## Repository Overview
This is an Nx monorepo workspace using React Router v7 with SSR, React 19, TypeScript, Vite, and Vitest.

## Tech Stack
- **Framework**: React 19 with React Router v7 (SSR enabled)
- **Build Tool**: Vite
- **Testing**: Vitest with Testing Library
- **Styling**: SCSS (CSS Modules supported)
- **Package Manager**: Bun (bun.lock present)
- **TypeScript**: Strict mode enabled
- **Linting**: ESLint with Nx flat config

## Nx Workspace Guidelines
- Always use Nx commands for running tasks (`nx run`, `nx run-many`, `nx affected`) instead of direct tooling
- Use Nx MCP tools to understand workspace architecture and project structure
- When generating new components, libraries, or apps, use Nx generators
- Follow Nx project boundaries and dependency rules
- See `AGENTS.md` for detailed Nx-specific guidelines

## React Router v7 Conventions
- Use file-based routing in the `app/routes/` directory
- Route files should export a default component or loader/action functions
- Use React Router's data APIs (loaders, actions) for data fetching
- Leverage SSR capabilities - ensure components are SSR-compatible
- Use `react-router.config.ts` for router-specific configuration
- Entry points: `entry.client.tsx` and `entry.server.tsx` handle hydration and SSR

## TypeScript Guidelines
- Strict mode is enabled - follow strict TypeScript practices
- Use explicit types for function parameters and return values
- Prefer `satisfies` over `as` for type assertions when possible
- Use TypeScript path aliases defined in `tsconfig.base.json`
- Enable `noUnusedLocals` - remove unused variables and imports
- Use `isolatedModules: true` - ensure each file can be compiled independently

## React 19 Best Practices
- Use functional components with hooks
- Prefer named exports for components
- Use TypeScript for all React components
- Follow React's rules of hooks - only call hooks at the top level
- Use React 19 features appropriately (e.g., new hooks, concurrent features)

## File Organization
- App code lives in `apps/coffee/app/`
- Routes go in `apps/coffee/app/routes/`
- Tests go in `apps/coffee/tests/` mirroring the app structure
- Styles: Use SCSS files alongside components (e.g., `component.module.scss`)
- Global styles in `apps/coffee/styles.scss`

## Component Structure
```typescript
// Preferred component structure
export function ComponentName() {
  // hooks
  // handlers
  // render
  return <div>...</div>;
}

export default ComponentName;
```

## Styling Guidelines
- Use SCSS for styling
- Prefer CSS Modules (`.module.scss`) for component-specific styles
- Global styles go in `styles.scss`
- Use meaningful class names following BEM or similar conventions

## Testing Guidelines
- Write tests in `tests/` directory mirroring app structure
- Use Vitest with Testing Library for React components
- Test files should be named `*.spec.tsx` or `*.test.tsx`
- Use `jsdom` environment for component tests
- Test user interactions, not implementation details

## Code Quality
- Run `nx lint` before committing
- Ensure all tests pass with `nx test`
- Use Prettier for code formatting (if configured)
- Follow ESLint rules defined in `eslint.config.mjs`
- Respect Nx module boundaries

## Vite Configuration
- Vite config is in `apps/coffee/vite.config.ts`
- Development server runs on port 4200
- Preview server runs on port 4300
- Test configuration is in the Vite config

## Import Conventions
- Use absolute imports when possible (configured via TypeScript paths)
- Group imports: external packages, then internal modules
- Use named imports for React Router hooks and utilities
- Avoid default imports except for components

## Error Handling
- Use React Router's error boundaries for route-level errors
- Handle async operations with proper error states
- Use TypeScript's strict null checks for safer code

## Performance
- Leverage React Router's data loading (loaders) to avoid waterfalls
- Use React 19's concurrent features appropriately
- Consider code splitting for large routes
- Optimize images and assets

## Git Workflow
- Create feature branches from `main` or `start-over`
- Ensure all Nx checks pass before committing
- Use meaningful commit messages

## When Creating New Features
1. Use Nx generators to scaffold components/libraries
2. Follow the existing file structure patterns
3. Write tests alongside implementation
4. Ensure TypeScript strict mode compliance
5. Run linting and tests before completion

## Common Commands
- `nx dev coffee` - Start development server
- `nx build coffee` - Build for production
- `nx test coffee` - Run tests
- `nx lint coffee` - Run linter
- `nx typecheck coffee` - Type check without building

## Notes
- The workspace uses Bun as the package manager (bun.lock present)
- SSR is enabled in React Router config
- Custom conditions `@org/source` are used in TypeScript config
- Workspace uses flat ESLint config format

